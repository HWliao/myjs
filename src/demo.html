<!DOCTYPE html>
<html lang="zh_cn">
<head>
  <meta charset="UTF-8">
  <title>editor</title>
  <link rel="stylesheet" href="lib/normalize/normalize.css">
  <script type="text/javascript" src="lib/modernizr/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="lib/jquery/jquery.min.js"></script>
  <style>
    #container {
      position: absolute;
      width: 500px;
      height: 300px;
      left: 600px;
      top: 100px;
    }

    #dropEl {
      position: absolute;
      width: 500px;
      height: 50px;
      left: 600px;
      top: 0;
      background-color: #000000;
    }
  </style>
</head>
<body>

<div id="container">

</div>
<div id="dropEl" style="" contenteditable="true"></div>
<div>
  <button class="session">session-1</button>
  <button class="session">session-2</button>
  <button class="session">session-3</button>
  <button class="session">session-4</button>
  <button class="session">session-5</button>
  <button class="session">session-6</button>
</div>
<div>
  <select class="emoji">
    <option value="[大笑]" data-img="lib/img/emoji_0.png">emoji0</option>
    <option value="[微笑]" data-img="lib/img/emoji_01.png">emoji1</option>
    <option value="[色]" data-img="lib/img/emoji_02.png">emoji2</option>
    <option value="[嘘]" data-img="lib/img/emoji_03.png">emoji3</option>
    <option value="[亲亲]" data-img="lib/img/emoji_04.png">emoji4</option>
  </select>
</div>
<div>
  <img class="im-image" src="lib/img/test.png" width="70" height="70">
  <button class="image" data-src="lib/img/test.png">插入图片给</button>
</div>
<div>
  <button class="hait" data-hait-account="123456" data-hait-text=" @工程师 (开发) "> @工程师 (开发)</button>
  <button class="haitSpan" data-hait-color="#24aeef" data-hait-account="123456" data-hait-text=" @工程师 (开发) "> @工程师
    (开发)
  </button>
</div>
<div>
  <button class="hasContents">是否有内容</button>
</div>
<div>
  <button class="clear">清除内容</button>
</div>
<script>
  var imEditor = new ImEditor('container', {
    bindings: {
      aenterAHait: {
        key: ImEditor.keys.ENTER,
        handler: function (range, context) {
          console.log('enterAHait');
          return true;
        }
      },
      aenterBSend1: {
        key: ImEditor.keys.ENTER,
        handler: function (range, context) {
          console.log('enterBSend1');
          return true;
        }
      },
      aenterBSend2: {
        key: ImEditor.keys.ENTER,
        shiftKey: true,
        handler: function (range, context) {
          console.log('enterBSend2');
          return true;
        }
      },
    },
    matchers: [
      ['IMG', function (node, detla) {
        console.log(111);
        return detla;
      }],
    ],
    dealImg: function (src) {
      return new Promise(function (resolve) {
        resolve(src);
      });
    },
    isValidImg: function (blob) {
      return blob && blob.size < 2 * 1024 * 1024;
    },
    dropEl: document.getElementById('dropEl'),
  });
  imEditor.on(ImEditor.events.TEXT_CHANGE, function () {
    console.log(arguments);
  });
  imEditor.on(ImEditor.events.SELECTION_CHANGE, function () {
    console.log(arguments);
  });
  imEditor.on(ImEditor.events.EDITOR_CONTEXT_MENU, function () {
    console.log(arguments);
  });
  imEditor.on(ImEditor.events.IMG_DBLCLICK, function () {
    console.log(arguments);
  });
  imEditor.on(ImEditor.events.DROP_AND_COPY_FILE, function () {
    console.log(arguments);
  });
  imEditor.on(ImEditor.events.DROP_AND_COPY_INVALID_IMAGE, function () {
    console.log(arguments);
  });
  imEditor.on(ImEditor.events.EDITOR_HAIT_KEYUP, function () {
    console.log(arguments);
  });
  imEditor.on('error', function () {
    console.log(arguments);
  });
  imEditor.on(ImEditor.events.click, function (e) {
    console.log(e);
  });
  //  $(document).on('mouseup', function (e) {
  //    imEditor.update('session-1');
  //  });
  // emoji模拟
  $('select.emoji').on('change', function (e) {
    console.log(e);
    var value = $(e.currentTarget).val();
    var img = $(e.currentTarget).find(':selected').attr('data-img');
    imEditor.insertEmoji(value, img, 'session-1');
  });
  // session模拟
  $('button.session').on('click', function (e) {
    var id = $(e.currentTarget).text();
    imEditor.activeEditor(id);
  });
  // images
  $('button.image').on('click', function (e) {
    imEditor.insertImage($(e.currentTarget).attr('data-src'), 'session-1');
  });
  // @
  $('button.hait').on('click', function (e) {
    imEditor.insertHaitImage($(e.currentTarget).attr('data-hait-account'), $(e.currentTarget).attr('data-hait-text'), 'lib/img/hait.png', 'session-1');
  });
  $('button.haitSpan').on('click', function (e) {
    imEditor.insertHaitSpan($(e.currentTarget).attr('data-hait-account'), $(e.currentTarget).attr('data-hait-text'), 'session-1');
  });

  $('button.hasContents').on('click', function () {
    alert(imEditor.hasContents('session-1'));
  });

  $('button.clear').on('click', function () {
    imEditor.clear('session-1');
  });
</script>
</body>
</html>
